<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Order Admin</title>
  <link rel="stylesheet" href="admin.css" />
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; margin:0; }
    .hidden { display:none; }
    .card { border:1px solid #ddd; border-radius:12px; padding:12px; margin:16px 0; }
    .btn { padding:8px 12px; border:1px solid #ccc; border-radius:10px; background:#f7f7f7; cursor:pointer; }
    .btn.danger { background:#bf2d2d; color:#fff; border-color:#bf2d2d; }
    .table { width:100%; border-collapse:collapse; }
    .table th, .table td { padding:8px 10px; border-bottom:1px solid #eee; text-align:left; }
    .right { text-align:right; }
    .badge { padding:2px 8px; border:1px solid #ddd; border-radius:999px; }
    .badge.paid { background:#e8f6e8; border-color:#9ad49a; }
    .badge.unpaid { background:#fff1f1; border-color:#f1b3b3; }
  </style>
</head>
<body>
  <section id="login" style="max-width:700px;margin:48px auto;text-align:center;">
    <h2>Admin Login</h2>
    <p id="loginMsg" style="color:#555;margin:8px 0 14px">Use your approved Google account.</p>
    <div id="gsi" style="display:inline-block;"></div>
  </section>

  <main id="app" class="hidden" style="max-width:1100px;margin:0 auto;padding:16px;">
    <h1>Order Admin Dashboard</h1>

    <section class="card">
      <h3>Connection</h3>
      <label>Apps Script Base URL (ends with <code>/exec</code>)</label>
      <input id="baseUrl" style="width:100%;padding:8px;border:1px solid #ccc;border-radius:8px" placeholder="https://script.google.com/macros/s/AKfy.../exec">
      <div style="margin-top:10px">
        <button id="saveConn" class="btn">Save</button>
        <button id="testConn" class="btn">Test</button>
        <span id="connMsg" style="margin-left:8px;color:#555"></span>
      </div>
      <div style="margin-top:10px">
        <button id="lockBtn" class="btn danger">Lock Orders</button>
        <button id="unlockBtn" class="btn">Unlock Orders</button>
        <span id="lockState" style="margin-left:8px;color:#555"></span>
      </div>
    </section>

    <section class="card">
      <h3>Search</h3>
      <div>
        <input id="query" placeholder="Order ID (A123456) or last name" style="padding:8px;border:1px solid #ccc;border-radius:8px">
        <select id="paidFilter" style="padding:8px;border:1px solid #ccc;border-radius:8px">
          <option value="">All</option>
          <option value="paid">Paid</option>
          <option value="unpaid">Unpaid</option>
        </select>
        <input id="fromDate" type="date" style="padding:8px;border:1px solid #ccc;border-radius:8px">
        <input id="toDate" type="date" style="padding:8px;border:1px solid #ccc;border-radius:8px">
        <button id="searchBtn" class="btn">Search</button>
        <button id="exportPaid" class="btn">Export Paid CSV</button>
      </div>
      <div id="results" style="margin-top:10px;"></div>
    </section>

    <section class="card">
      <h3>Paid Totals</h3>
      <button id="refreshTotals" class="btn">Refresh</button>
      <span id="paidSum" class="badge" style="margin-left:8px"></span>
      <span id="paidCount" class="badge" style="margin-left:8px"></span>
      <div id="totalsBreakdown" style="margin-top:6px;color:#555"></div>
    </section>
  </main>

  <template id="detailTemplate">
    <tr class="detail-row">
      <td colspan="6">
        <div><strong>Contact:</strong> <span class="contact"></span></div>
        <div><strong>Email:</strong> <span class="email"></span> â€” <strong>Phone:</strong> <span class="phone"></span></div>
        <table class="table" style="margin-top:6px">
          <thead>
            <tr><th>SKU</th><th>Item</th><th>Size</th><th>Qty</th><th>Custom Name</th><th>Unit</th><th>Line</th></tr>
          </thead>
          <tbody class="lines"></tbody>
        </table>
        <div style="margin-top:8px">
          <a data-view target="_blank" class="btn">View (public)</a>
          <button data-print class="btn">Print Pack Slip</button>
        </div>
      </td>
    </tr>
  </template>

  <script src="admin.js"></script>
</body>
</html>
